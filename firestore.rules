rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if user is admin (customize based on your auth)
    function isAdmin() {
      return request.auth != null &&
             request.auth.token.admin == true;
    }

    // Registrations collection
    match /registrations/{registrationId} {
      // Allow public to create (no auth required for registration)
      allow create: if true;

      // Only admins can read, update, delete
      allow read, update, delete: if isAdmin();

      // Validate required fields on create
      allow create: if request.resource.data.keys().hasAll([
        'student', 'guardians', 'school', 'metadata'
      ]);
    }
  }
}